const Ht=new Intl.Collator("en",{numeric:!0,sensitivity:"base"}).compare,St=1/0,It=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),Ct="eexxaacctt",Xt="A-Z",Gt="a-z",rt=(t,n,s)=>t.replace(Xt,n).replace(Gt,s),zt={unicode:!1,alpha:null,interSplit:"[^A-Za-z\\d']+",intraSplit:"[a-z][A-Z]",intraBound:"[A-Za-z]\\d|\\d[A-Za-z]|[a-z][A-Z]",interLft:0,interRgt:0,interChars:".",interIns:St,intraChars:"[a-z\\d']",intraIns:null,intraContr:"'[a-z]{1,2}\\b",intraMode:0,intraSlice:[1,St],intraSub:null,intraTrn:null,intraDel:null,intraFilt:(t,n,s)=>!0,sort:(t,n,s)=>{let{idx:i,chars:l,terms:a,interLft2:g,interLft1:L,start:O,intraIns:F,interIns:S}=t;return i.map((z,b)=>b).sort((z,b)=>l[b]-l[z]||F[z]-F[b]||a[b]+g[b]+.5*L[b]-(a[z]+g[z]+.5*L[z])||S[z]-S[b]||O[z]-O[b]||Ht(n[i[z]],n[i[b]]))}},Lt=(t,n)=>n==0?"":n==1?t+"??":n==St?t+"*?":t+`{0,${n}}?`,bt="(?:\\b|_)";function v(t){t=Object.assign({},zt,t);let{unicode:n,interLft:s,interRgt:i,intraMode:l,intraSlice:a,intraIns:g,intraSub:L,intraTrn:O,intraDel:F,intraContr:S,intraSplit:z,interSplit:b,intraBound:at,intraChars:tt}=t;g??(g=l),L??(L=l),O??(O=l),F??(F=l);let ht=t.letters??t.alpha;if(ht!=null){let e=ht.toLocaleUpperCase(),u=ht.toLocaleLowerCase();b=rt(b,e,u),z=rt(z,e,u),at=rt(at,e,u),tt=rt(tt,e,u),S=rt(S,e,u)}let U=n?"u":"";const dt='".+?"',yt=new RegExp(dt,"gi"+U),Mt=new RegExp(`(?:\\s+|^)-(?:${tt}+|${dt})`,"gi"+U);let{intraRules:gt}=t;gt==null&&(gt=e=>{let u=zt.intraSlice,x=0,h=0,c=0,o=0;if(/[^\d]/.test(e)){let R=e.length;R<=4?R>=3&&(c=Math.min(O,1),R==4&&(x=Math.min(g,1))):(u=a,x=g,h=L,c=O,o=F)}return{intraSlice:u,intraIns:x,intraSub:h,intraTrn:c,intraDel:o}});let $t=!!z,Zt=new RegExp(z,"g"+U),Bt=new RegExp(b,"g"+U),Dt=new RegExp("^"+b+"|"+b+"$","g"+U),Pt=new RegExp(S,"gi"+U);const ut=e=>{let u=[];e=e.replace(yt,h=>(u.push(h),Ct)),e=e.replace(Dt,"").toLocaleLowerCase(),$t&&(e=e.replace(Zt,h=>h[0]+" "+h[1]));let x=0;return e.split(Bt).filter(h=>h!="").map(h=>h===Ct?u[x++]:h)},qt=/[^\d]+|\d+/g,pt=(e,u=0,x=!1)=>{let h=ut(e);if(h.length==0)return[];let c=Array(h.length).fill("");h=h.map((m,p)=>m.replace(Pt,M=>(c[p]=M,"")));let o;if(l==1)o=h.map((m,p)=>{if(m[0]==='"')return It(m.slice(1,-1));let M="";for(let d of m.matchAll(qt)){let f=d[0],{intraSlice:r,intraIns:E,intraSub:w,intraTrn:A,intraDel:_}=gt(f);if(E+w+A+_==0)M+=f+c[p];else{let[P,et]=r,N=f.slice(0,P),J=f.slice(et),y=f.slice(P,et);E==1&&N.length==1&&N!=y[0]&&(N+="(?!"+N+")");let K=y.length,W=[f];if(w)for(let I=0;I<K;I++)W.push(N+y.slice(0,I)+tt+y.slice(I+1)+J);if(A)for(let I=0;I<K-1;I++)y[I]!=y[I+1]&&W.push(N+y.slice(0,I)+y[I+1]+y[I]+y.slice(I+2)+J);if(_)for(let I=0;I<K;I++)W.push(N+y.slice(0,I+1)+"?"+y.slice(I+1)+J);if(E){let I=Lt(tt,1);for(let q=0;q<K;q++)W.push(N+y.slice(0,q)+I+y.slice(q)+J)}M+="(?:"+W.join("|")+")"+c[p]}}return M});else{let m=Lt(tt,g);u==2&&g>0&&(m=")("+m+")("),o=h.map((p,M)=>p[0]==='"'?It(p.slice(1,-1)):p.split("").map((d,f,r)=>(g==1&&f==0&&r.length>1&&d!=r[f+1]&&(d+="(?!"+d+")"),d)).join(m)+c[M])}let R=s==2?bt:"",D=i==2?bt:"",X=D+Lt(t.interChars,t.interIns)+R;return u>0?x?o=R+"("+o.join(")"+D+"|"+R+"(")+")"+D:(o="("+o.join(")("+X+")(")+")",o="(.??"+R+")"+o+"("+D+".*)"):(o=o.join(X),o=R+o+D),[new RegExp(o,"i"+U),h,c]},ot=(e,u,x)=>{let[h]=pt(u);if(h==null)return null;let c=[];if(x!=null)for(let o=0;o<x.length;o++){let R=x[o];h.test(e[R])&&c.push(R)}else for(let o=0;o<e.length;o++)h.test(e[o])&&c.push(o);return c};let At=!!at,xt=new RegExp(b,U),Rt=new RegExp(at,U);const Et=(e,u,x)=>{let[h,c,o]=pt(x,1),[R]=pt(x,2),D=c.length,X=e.length,m=Array(X).fill(0),p={idx:Array(X),start:m.slice(),chars:m.slice(),terms:m.slice(),interIns:m.slice(),intraIns:m.slice(),interLft2:m.slice(),interRgt2:m.slice(),interLft1:m.slice(),interRgt1:m.slice(),ranges:Array(X)},M=s==1||i==1,d=0;for(let f=0;f<e.length;f++){let r=u[e[f]],E=r.match(h),w=E.index+E[1].length,A=w,_=!1,P=0,et=0,N=0,J=0,y=0,K=0,W=0,I=0,q=[];for(let T=0,j=2;T<D;T++,j+=2){let k=E[j].toLocaleLowerCase(),H=c[T],G=H[0]=='"'?H.slice(1,-1):H+o[T],Z=G.length,B=k.length,$=k==G;if(!$&&E[j+1].length>=Z){let C=E[j+1].toLocaleLowerCase().indexOf(G);C>-1&&(q.push(A,B,C,Z),A+=mt(E,j,C,Z),k=G,B=Z,$=!0,T==0&&(w=A))}if(M||$){let C=A-1,Q=A+B,V=!1,it=!1;if(C==-1||xt.test(r[C]))$&&P++,V=!0;else{if(s==2){_=!0;break}if(At&&Rt.test(r[C]+r[C+1]))$&&et++,V=!0;else if(s==1){let ct=E[j+1],lt=A+B;if(ct.length>=Z){let Y=0,nt=!1,Ot=new RegExp(G,"ig"+U),_t;for(;_t=Ot.exec(ct);){Y=_t.index;let Tt=lt+Y,wt=Tt-1;if(wt==-1||xt.test(r[wt])){P++,nt=!0;break}else if(Rt.test(r[wt]+r[Tt])){et++,nt=!0;break}}nt&&(V=!0,q.push(A,B,Y,Z),A+=mt(E,j,Y,Z),k=G,B=Z,$=!0,T==0&&(w=A))}if(!V){_=!0;break}}}if(Q==r.length||xt.test(r[Q]))$&&N++,it=!0;else{if(i==2){_=!0;break}if(At&&Rt.test(r[Q-1]+r[Q]))$&&J++,it=!0;else if(i==1){_=!0;break}}$&&(y+=Z,V&&it&&K++)}if(B>Z&&(I+=B-Z),T>0&&(W+=E[j-1].length),!t.intraFilt(G,k,A)){_=!0;break}T<D-1&&(A+=B+E[j+1].length)}if(!_){p.idx[d]=e[f],p.interLft2[d]=P,p.interLft1[d]=et,p.interRgt2[d]=N,p.interRgt1[d]=J,p.chars[d]=y,p.terms[d]=K,p.interIns[d]=W,p.intraIns[d]=I,p.start[d]=w;let T=r.match(R),j=T.index+T[1].length,k=q.length,H=k>0?0:1/0,G=k-4;for(let C=2;C<T.length;){let Q=T[C].length;if(H<=G&&q[H]==j){let V=q[H+1],it=q[H+2],ct=q[H+3],lt=C,Y="";for(let nt=0;nt<V;lt++)Y+=T[lt],nt+=T[lt].length;T.splice(C,lt-C,Y),j+=mt(T,C,it,ct),H+=4}else j+=Q,C++}j=T.index+T[1].length;let Z=p.ranges[d]=[],B=j,$=j;for(let C=2;C<T.length;C++){let Q=T[C].length;j+=Q,C%2==0?$=j:Q>0&&(Z.push(B,$),B=$=j)}$>B&&Z.push(B,$),d++}}if(d<e.length)for(let f in p)p[f]=p[f].slice(0,d);return p},mt=(e,u,x,h)=>{let c=e[u]+e[u+1].slice(0,x);return e[u-1]+=c,e[u]=e[u+1].slice(x,x+h),e[u+1]=e[u+1].slice(x+h),c.length},Ut=5,Nt=(e,u,x,h=1e3,c)=>{x=x?x===!0?Ut:x:0;let o=null,R=null,D=[];u=u.replace(Mt,f=>{let r=f.trim().slice(1);return r[0]==='"'&&(r=It(r.slice(1,-1))),D.push(r),""});let X=ut(u),m;if(D.length>0){if(m=new RegExp(D.join("|"),"i"+U),X.length==0){let f=[];for(let r=0;r<e.length;r++)m.test(e[r])||f.push(r);return[f,null,null]}}else if(X.length==0)return[null,null,null];if(x>0){let f=ut(u);if(f.length>1){let r=f.slice().sort((w,A)=>A.length-w.length);for(let w=0;w<r.length;w++){if((c==null?void 0:c.length)==0)return[[],null,null];c=ot(e,r[w],c)}if(f.length>x)return[c,null,null];o=jt(f).map(w=>w.join(" ")),R=[];let E=new Set;for(let w=0;w<o.length;w++)if(E.size<c.length){let A=c.filter(P=>!E.has(P)),_=ot(e,o[w],A);for(let P=0;P<_.length;P++)E.add(_[P]);R.push(_)}else R.push([])}}o==null&&(o=[u],R=[(c==null?void 0:c.length)>0?c:ot(e,u)]);let p=null,M=null;if(D.length>0&&(R=R.map(f=>f.filter(r=>!m.test(e[r])))),R.reduce((f,r)=>f+r.length,0)<=h){p={},M=[];for(let f=0;f<R.length;f++){let r=R[f];if(r==null||r.length==0)continue;let E=o[f],w=Et(r,e,E),A=t.sort(w,e,E);if(f>0)for(let _=0;_<A.length;_++)A[_]+=M.length;for(let _ in w)p[_]=(p[_]??[]).concat(w[_]);M=M.concat(A)}}return[[].concat(...R),p,M]};return{search:(...e)=>Nt(...e),split:ut,filter:ot,info:Et,sort:t.sort}}const Qt=(()=>{let t={A:"ÁÀÃÂÄĄ",a:"áàãâäą",E:"ÉÈÊËĖ",e:"éèêëę",I:"ÍÌÎÏĮ",i:"íìîïį",O:"ÓÒÔÕÖ",o:"óòôõö",U:"ÚÙÛÜŪŲ",u:"úùûüūų",C:"ÇČĆ",c:"çčć",L:"Ł",l:"ł",N:"ÑŃ",n:"ñń",S:"ŠŚ",s:"šś",Z:"ŻŹ",z:"żź"},n=new Map,s="";for(let a in t)t[a].split("").forEach(g=>{s+=g,n.set(g,a)});let i=new RegExp(`[${s}]`,"g"),l=a=>n.get(a);return a=>{if(typeof a=="string")return a.replace(i,l);let g=Array(a.length);for(let L=0;L<a.length;L++)g[L]=a[L].replace(i,l);return g}})();function jt(t){t=t.slice();let n=t.length,s=[t.slice()],i=new Array(n).fill(0),l=1,a,g;for(;l<n;)i[l]<l?(a=l%2&&i[l],g=t[l],t[l]=t[a],t[a]=g,++i[l],l=1,s.push(t.slice())):(i[l]=0,++l);return s}const Wt=(t,n)=>n?`<mark>${t}</mark>`:t,kt=(t,n)=>t+n;function Jt(t,n,s=Wt,i="",l=kt){i=l(i,s(t.substring(0,n[0]),!1))??i;for(let a=0;a<n.length;a+=2){let g=n[a],L=n[a+1];i=l(i,s(t.substring(g,L),!0))??i,a<n.length-3&&(i=l(i,s(t.substring(n[a+1],n[a+2]),!1))??i)}return i=l(i,s(t.substring(n[n.length-1]),!1))??i,i}v.latinize=Qt;v.permute=t=>jt([...Array(t.length).keys()]).sort((s,i)=>{for(let l=0;l<s.length;l++)if(s[l]!=i[l])return s[l]-i[l];return 0}).map(s=>s.map(i=>t[i]));v.highlight=Jt;let st=!1;function Yt(t=!st){st=t}let ft=new v({intraMode:1});function vt(){st=!st,st?ft=new v({intraMode:0,interLft:1,interRgt:1}):ft=new v({intraMode:1,interLft:0,interRgt:0})}function Kt(t,n){let s;return(...i)=>{const l=this;return new Promise((a,g)=>{const L=()=>{s=null,a(t.apply(l,i))},O=!s;clearTimeout(s),s=setTimeout(L,n),O&&a(t.apply(l,i))})}}function Vt(t,n,s){const i=t.filter(l=>(n==null?void 0:n.length)<1?!0:n.map(a=>a.toLowerCase()).includes(l.category.toLowerCase()));if(s){const l=i.map(S=>[S.title,S.subtitle,S.tags.map(z=>"hashtag-"+z),S.content,S.description].join(" ")),a=ft.filter(l,s),g=ft.info(a,l,s),L=ft.sort(g,l,s),O=(S,z)=>z?'<b style="color:var(--brand-accent)">'+S+"</b>":S;return L.map(S=>{const z=i[g.idx[L[S]]],b=v.highlight(l[g.idx[L[S]]].replaceAll("<"," ").replaceAll("/>","  ").replaceAll(">"," "),g.ranges[L[S]],O).slice(Math.max(g.ranges[L[S]][0]-200,0),Math.min(g.ranges[L[S]][1]+200,l[g.idx[L[S]]].length)).split(" ").slice(1,-1).join(" ");return{...z,highlightedResults:b}})}else return i}function Ft(t,n,s){return Kt(Vt,100)(t,n,s)}export{vt as changeSearchMode,Ft as fuzzySearch,st as isSearchExact,Yt as setIsSearchExact};
