import{ref as R,watch as O,onMounted as g,onUnmounted as j,h as E,defineComponent as b}from"@histoire/vendors/vue";import{components as $}from"@histoire/controls";import*as r from"virtual:$histoire-setup";import*as a from"virtual:$histoire-generated-global-setup";import x from"./RenderStory.svelte.js";import A from"./RenderVariant.svelte.js";import N from"./Wrap.svelte.js";import{syncState as V}from"./util.js";const U=b({name:"RenderStory",props:{variant:{type:Object,required:!0},story:{type:Object,required:!0},slotName:{type:String,default:"default"}},setup(t,{emit:s}){const f=R();let u,i,l=[];function _(n,c){document.addEventListener(n,c);const e=()=>document.removeEventListener(n,c);return l.push(e),{off:e}}async function y(){i=document.createElement("div"),f.value.appendChild(i);let n=[];const{off:c}=_("SvelteRegisterComponent",o=>{const{component:m}=o.detail;n.push(m)});u=new t.story.file.component({target:i,props:{Hst:{Story:x,Variant:A,...q()}},context:new Map(Object.entries({__hstStory:t.story,__hstVariant:t.variant,__hstSlot:t.slotName}))});let e=n.find(o=>o.$$===u.$$);c(),n=[];function v(){const o=e.$replace;o&&(e.$replace=(...m)=>{const w=o.apply(e,m);return e=w,h(),v(),w})}v();const{apply:S,stop:C}=V(t.variant.state,o=>{e.$inject_state(o)});l.push(C);function h(){e.$$.after_update.push(()=>{S(e.$capture_state())})}h(),S(e.$capture_state());const p={app:u,story:t.story,variant:t.variant};typeof(a==null?void 0:a.setupSvelte3)=="function"&&await a.setupSvelte3(p),typeof(r==null?void 0:r.setupSvelte3)=="function"&&await r.setupSvelte3(p),typeof(a==null?void 0:a.setupSvelte4)=="function"&&await a.setupSvelte4(p),typeof(r==null?void 0:r.setupSvelte4)=="function"&&await r.setupSvelte4(p),typeof t.variant.setupApp=="function"&&await t.variant.setupApp(p),s("ready")}function d(){var n;u==null||u.$destroy(),i&&((n=i.parentNode)==null||n.removeChild(i),i=null),l.forEach(c=>c()),l=[]}return O(()=>t.story.id,async()=>{d(),await y()}),g(async()=>{await y()}),j(()=>{d()}),{el:f}},render(){return E("div",{ref:"el"})}});function q(){const t={};for(const s in $)t[s.substring(3)]=H($[s]);return t}function H(t){function s(f){return new N({...f,props:{...f.props,controlComponent:t}})}return s}export{U as default};
